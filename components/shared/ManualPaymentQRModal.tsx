
import React, { useState, useMemo } from 'react';
import { QRCodeCanvas } from 'qrcode.react';
import { X, QrCode, MessageSquare, Copy, Check, ShoppingBag, ShieldCheck } from 'lucide-react';
import type { CartItem } from '../../types.ts';

const UPI_ID = 'vips1680-2@okicici';
const PAYEE_NAME = 'Powerful Tools';
const ADMIN_CONTACT = '7891474105';

// --- SVG Logo Components for UPI Apps ---
const GPayLogo = () => (
    <svg height="65" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="google-pay" aria-label="Google Pay">
      <path fill="#4285F4" d="M8.079,11.7c0-0.281-0.023-0.562-0.071-0.838H4.121v1.587h2.226c-0.092,0.512-0.389,0.965-0.823,1.252v1.031h1.329C7.631,14.016,8.079,12.955,8.079,11.7z"></path>
      <path fill="#34A853" d="M4.121,15.728c1.113,0,2.05-0.365,2.732-0.995l-1.329-1.031c-0.37,0.251-0.846,0.394-1.404,0.394c-1.075,0-1.987-0.724-2.313-1.701H0.439v1.062C1.139,14.85,2.564,15.728,4.121,15.728L4.121,15.728z"></path>
      <path fill="#FBBC04" d="M1.808,12.395c-0.172-0.511-0.172-1.066,0-1.578V9.756H0.439c-0.586,1.165-0.586,2.537,0,3.702L1.808,12.395L1.808,12.395z"></path>
      <path fill="#EA4335" d="M4.121,9.117c0.588-0.009,1.155,0.212,1.581,0.618l1.177-1.176C6.133,7.858,5.145,7.474,4.121,7.485c-1.557,0-2.982,0.88-3.682,2.271l1.369,1.062C2.134,9.841,3.046,9.117,4.121,9.117L4.121,9.117z"></path>
      <path fill="#2D9248" d="M1.808,12.395L1.808,12.395l-1.369,1.062l0,0c0.7,1.392,2.125,2.271,3.682,2.271l0,0v-1.632l0,0C3.046,14.096,2.134,13.372,1.808,12.395L1.808,12.395z"></path>
      <path fill="#DBA403" d="M0.439,9.756L0.439,9.756c-0.586,1.165-0.586,2.537,0,3.702l0,0l1.369-1.062c-0.172-0.511-0.172-1.066,0-1.578l0,0L0.439,9.756L0.439,9.756z"></path>
      <path fill="#CC3A2E" d="M4.121,7.485L4.121,7.485c-1.557,0-2.982,0.88-3.682,2.271l0,0l1.369,1.062c0.326-0.977,1.239-1.701,2.313-1.701l0,0V7.485L4.121,7.485z"></path>
      <path fill="#5F6368" d="M10.917,11.497v2.904H9.995V7.227h2.444c0.59-0.012,1.16,0.211,1.583,0.621c0.429,0.386,0.67,0.938,0.661,1.514c0.013,0.58-0.229,1.137-0.661,1.523c-0.428,0.408-0.955,0.612-1.583,0.61L10.917,11.497L10.917,11.497z M10.917,8.11v2.505h1.545c0.343,0.01,0.673-0.125,0.912-0.372c0.484-0.47,0.495-1.245,0.024-1.729l-0.024-0.024c-0.235-0.252-0.568-0.39-0.912-0.381H10.917L10.917,8.11z M16.807,9.332c0.682,0,1.219,0.182,1.613,0.546c0.394,0.364,0.59,0.864,0.59,1.497v3.026H18.13v-0.682h-0.04c-0.381,0.561-0.89,0.841-1.523,0.841c-0.54,0-0.993-0.16-1.357-0.481c-0.353-0.298-0.554-0.739-0.545-1.202c0-0.508,0.192-0.912,0.576-1.212c0.384-0.3,0.896-0.45,1.538-0.45c0.547,0,0.999,0.1,1.352,0.3v-0.211c0.002-0.316-0.138-0.615-0.381-0.816c-0.244-0.219-0.562-0.34-0.89-0.336c-0.515,0-0.922,0.218-1.222,0.651l-0.811-0.511C15.271,9.652,15.932,9.332,16.807,9.332L16.807,9.332z M15.614,12.898c-0.001,0.238,0.113,0.462,0.305,0.601c0.204,0.16,0.457,0.245,0.716,0.24c0.389-0.001,0.762-0.156,1.037-0.431c0.305-0.288,0.458-0.624,0.458-1.011c-0.287-0.229-0.688-0.344-1.203-0.344c-0.374,0-0.687,0.09-0.937,0.271C15.74,12.408,15.614,12.631,15.614,12.898L15.614,12.898z M24.071,9.492l-3.077,7.073h-0.951l1.142-2.475l-2.024-4.598h1.001l1.462,3.526h0.02l1.423-3.526H24.071L24.071,9.492z"></path>
      <path fill="#53565B" d="M10.917,12.395H9.995v2.005h0.922V12.395L10.917,12.395z M19.011,12.395h-0.883c-0.024,0.346-0.176,0.65-0.455,0.913c-0.275,0.275-0.648,0.43-1.037,0.431c-0.008,0-0.015,0-0.022,0c-0.251,0-0.495-0.085-0.694-0.24c-0.193-0.139-0.306-0.363-0.305-0.601c0-0.189,0.063-0.356,0.189-0.503h-1.073c-0.044,0.149-0.067,0.309-0.067,0.482c-0.009,0.463,0.192,0.904,0.545,1.202c0.364,0.321,0.817,0.481,1.357,0.481c0.633,0,1.142-0.28,1.523-0.841h0.04v0.682h0.881V12.395L19.011,12.395z M22.808,12.395h-0.912l-0.251,0.623h-0.02l-0.258-0.623h-0.928l0.746,1.695l-1.142,2.475h0.951L22.808,12.395L22.808,12.395z"></path>
    </svg>
);

const PhonePeLogo = () => (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1366 768" id="phonepe">
  <defs>
    <clipPath id="a">
      <rect width="1366" height="768" fill="none"></rect>
    </clipPath>
  </defs>
  <g clip-path="url(#a)">
    <path fill="#5f259f" d="M332.63 514.18c-3.88-.38-7.78-.64-11.64-1.15-25.26-3.35-47.76-13.07-67.18-29.6a127.87 127.87 0 0 1-41.44-65.75 124.29 124.29 0 0 1-3.78-42.55c2-24.95 10.33-47.61 25.5-67.51 21.24-27.87 49.33-44.9 84-50.05 37.84-5.63 72 3.92 101.51 28.13 25.43 20.83 40.77 47.94 45.43 80.46 5.5 38.35-4.36 72.79-29.38 102.44-21.07 25-48.24 39.43-80.53 44.3-4.05.62-8.16.86-12.24 1.28zm-23.78-171c-10.43 0-20.85 0-31.28 0-2.78 0-3.77.84-4 3.58a35.11 35.11 0 0 0 .15 8 9.19 9.19 0 0 0 9.18 8.06c2.4.05 4.8 0 7.2 0 3 0 3 0 3 2.95q0 16.75 0 33.5a50.67 50.67 0 0 0 1.73 13.2c3.21 12 10.21 20.59 22.36 24.17 10.15 3 20.34 2.27 30.36-1 2.35-.77 2.39-.77 2.4 1.72 0 6.92-.05 13.84 0 20.76a11.07 11.07 0 0 0 11.25 11.22c3.29 0 6.59.06 9.88 0a4.2 4.2 0 0 0 4.29-4.3c0-.82 0-1.64 0-2.46q0-48.42 0-96.81c0-3.68 0-3.68 3.58-3.68 4.18 0 8.37 0 12.55 0 3.1 0 4-.95 4-4.1q0-3.07 0-6.17c-.07-5.6-3.83-9.33-9.48-9.38q-7.41-.06-14.81 0a4 4 0 0 1-3.41-1.51c-1.85-2.2-3.77-4.35-5.66-6.51Q346 315.77 329.79 297.18a13.29 13.29 0 0 0-10.6-5c-6.67.08-12.59 3-18.74 5.07-1.87.62-2.07 3-.76 4.5a20 20 0 0 0 1.46 1.45Q321.07 322.11 341 341c.48.45 1.36.88 1.14 1.57-.28.9-1.29.53-2 .53-10.43 0-20.85 0-31.28 0M1158.42 427c-1.38 2.26-3.36 3.07-6.05 3.05-13.65-.1-27.3 0-40.95-.09-2 0-2.9.46-2.82 2.59.07 1.56-.34 3.13-.36 4.7-.11 7.55 4.75 12.61 12.33 13.16s14.78-1.54 21.66-4.74c4.91-2.27 5.88-2 8.89 2.6 2.14 3.26 4 6.58 2.52 10.73a10 10 0 0 1-4.77 5.69c-10.45 5.53-21.64 7.14-33.3 6.12a42.24 42.24 0 0 1-15.77-4.33c-11.57-6-17.36-15.76-17.91-28.45-.46-10.6-.24-21.24-.06-31.86.29-18.13 12.62-31.35 31-33.51a57.6 57.6 0 0 1 19.64.67c14.66 3.35 23.45 12.93 25.57 27.82.08.53.23 1.06.35 1.59zm-36.92-12.42c3.84 0 7.68 0 11.52 0 1.39 0 2-.5 2-1.92 0-2.19 0-4.38 0-6.57-.25-7-4.21-11.67-11.19-12.56-8.84-1.13-15.34 3.42-15.52 12.79 0 2 .07 4 0 6s.67 2.36 2.42 2.31c3.63-.09 7.26 0 10.9 0M550.94 450.08c0 4.8 0 9.59 0 14.39 0 3.27-1.71 5.18-5 5.26q-7.71.18-15.42 0c-3-.07-4.64-1.74-5-4.68a18.35 18.35 0 0 1-.13-2.46q0-54.66 0-109.32c0-1 .09-1.92.18-2.87a6.32 6.32 0 0 1 4.67-5.67c11.27-3.75 22.81-6 34.72-5.69 9.35.27 18.19 2.5 26 7.88 9 6.17 14.39 14.76 15.69 25.46a114.65 114.65 0 0 1-.17 32.15 37.2 37.2 0 0 1-32.62 30.79c-7.15.87-14.24.86-21.12-1.65-1.53-.56-1.77.13-1.77 1.42 0 5 0 10 0 15m.79-63.37c0 7.12.06 14.23 0 21.35a3.19 3.19 0 0 0 2.24 3.38c3.77 1.71 7.71 1.75 11.7 1.53 9.35-.51 16-7.36 16-16.72-.05-6.94.53-13.88-.75-20.82-1-5.57-3.43-9.93-8.67-12.37-6.18-2.88-12.49-2.51-18.84-.59-1.44.44-1.61 1.4-1.61 2.68 0 7.18 0 14.37 0 21.56M990.88 407.68V353.2c0-5.69 1.28-7.39 6.65-9.08 10.54-3.31 21.29-5.35 32.36-5.1 10.67.24 20.62 2.91 29.1 9.78a35.37 35.37 0 0 1 13.21 23.86 114.3 114.3 0 0 1 0 30.75c-2.49 16.62-13.65 27.94-30.3 31.43a43 43 0 0 1-23.15-1c-1.82-.64-2.24-.15-2.23 1.65.06 9.39 0 18.78 0 28.16 0 4.41-1.69 6.15-6 6.17s-8.78 0-13.17 0-6.35-1.86-6.4-6.38V407.68zm26.42-21c0 7.19.05 14.39 0 21.58a3 3 0 0 0 2 3.12c3.75 1.77 7.69 1.84 11.69 1.64 9.49-.45 16.12-7.31 16.21-16.78 0-4.59 0-9.19 0-13.78a39.82 39.82 0 0 0-1.77-10.63 13.1 13.1 0 0 0-7.08-8.4c-6.09-3.1-12.41-2.85-18.83-1.17a2.64 2.64 0 0 0-2.27 3c.1 7.13 0 14.25 0 21.38M620.67 404q0-29.81 0-59.62c0-4.51 1.64-6.19 6.21-6.16 3.29 0 6.59-.28 9.86.27a10.91 10.91 0 0 1 9.27 9.65c.67 6.63.14 13.29.27 19.93 0 1.78.06 3.56 0 5.34-.06 1.51.33 2.15 2 1.68a69.5 69.5 0 0 1 13.78-2.15c17.51-1.32 31.54 8.93 35.3 26a54.47 54.47 0 0 1 1.36 12c0 17.62 0 35.23 0 52.84 0 4.13-1.74 5.92-5.83 6q-3.92.06-7.82 0a11.92 11.92 0 0 1-12-12.08q-.06-22.41 0-44.81a29.29 29.29 0 0 0-1-8.75c-1.49-4.84-4.8-7.51-9.75-8.26a36.52 36.52 0 0 0-13.65.92c-1.9.43-2.49 1.37-2.48 3.29q.09 30.84 0 61.67c0 .82 0 1.65 0 2.47-.27 3.74-2 5.49-5.76 5.54q-7.1.09-14.2 0c-3.87 0-5.62-1.86-5.62-5.73q0-30 0-60M712.11 420.9c.23-4.79-.42-11 .33-17.11 1.81-14.86 10-24.47 24.27-28.7a53.23 53.23 0 0 1 35.12 1.13c13.13 5.1 20 15.06 21.11 29 .81 10.25.38 20.54.27 30.81s-3.26 19.68-11.48 26.68c-6.17 5.26-13.53 7.69-21.41 8.7a54.73 54.73 0 0 1-25.17-2.34c-14.06-4.85-22.83-16.93-23-31.78-.07-5 0-10 0-16.37m26.94.25c0 5.54-.07 10 0 14.44.15 7.85 3.83 12.37 11.43 13.33 9 1.15 16.81-2 17.09-12.94.23-9.1.16-18.21 0-27.32-.13-7.43-4-12.17-10.56-13.47a24.66 24.66 0 0 0-5.95-.19c-6.47.31-10.85 4.42-11.7 10.82-.71 5.46-.11 10.95-.34 15.33M949.33 430c-7.07 0-14.13.06-21.2 0-1.78 0-2.52.66-2.58 2.33-.07 2.32-.7 4.61-.38 7 .86 6.36 5.53 10.62 12.08 11.14 7.62.6 14.68-1.28 21.47-4.52 5.36-2.56 6.43-2.26 9.62 2.82 2.13 3.38 3.9 6.85 2 11a8.66 8.66 0 0 1-3.72 4.52c-16.52 8.35-33.49 10-50.45 1.88-10.56-5-16.23-14.28-17.12-25.86a263.21 263.21 0 0 1 0-37.15c.89-13.92 10.1-24.95 24-28.92a51.91 51.91 0 0 1 29.23-.07c13 3.79 20.43 12.79 22.58 26 1.32 8.22.85 16.54.7 24.82-.07 3.51-2 5.05-5.63 5.06H949.33m-10.8-15.42c3.9 0 7.81 0 11.71 0 1.28 0 1.9-.42 1.86-1.78-.06-2.12.06-4.25-.05-6.36-.37-7.28-4.38-12-11.37-12.9-7.22-.95-14.13 1.85-15.39 10.94-.38 2.73-.1 5.47-.22 8.2-.07 1.44.56 1.92 1.95 1.9 3.84-.05 7.67 0 11.51 0M808 424.22q0-19.22 0-38.44c0-4.34 1.42-6.12 5.53-7.49a99.42 99.42 0 0 1 31.89-5.45c10.53 0 20.65 1.84 29 9 6.7 5.75 9.8 13.34 11.14 21.84a53.77 53.77 0 0 1 .45 8.4q0 25.8 0 51.6c0 4.41-1.64 6.09-6.1 6.06-3.35 0-6.72.3-10.06-.24-5.57-.91-9.18-5-9.2-10.64-.06-14.6 0-29.19 0-43.79a48.87 48.87 0 0 0-.75-9.81c-1.32-6.41-5.54-10-12.06-10.29a61 61 0 0 0-11.68.69c-2 .31-2.55 1.19-2.54 3.11q.07 31.44 0 62.9c0 .82 0 1.65 0 2.46a5 5 0 0 1-5 4.81c-5.28.1-10.57.11-15.85 0-3-.06-4.77-2.09-4.78-5.27q0-19.74 0-39.47"></path>
    <path fill="#5f259f" d="M350,388.34c0,7.61-.05,15.21,0,22.81a3,3,0,0,1-2.31,3.3,36.61,36.61,0,0,1-15.21,1.84c-8.75-.83-13.64-6-14.38-14.87-.68-8.14-.18-16.29-.32-24.44-.06-4,0-7.94,0-11.91,0-1.65.54-2.32,2.27-2.31,9.19.06,18.38.08,27.56,0,2,0,2.42.81,2.41,2.58-.06,7.67,0,15.34,0,23"></path>
  </g>
</svg>
);

const PaytmLogo = () => (
    <svg width="65" height="21" viewBox="-164 191.6 512 193" xmlns="http://www.w3.org/2000/svg" xmlSpace="preserve" id="paytm" x="0" y="0" version="1.1" aria-label="Paytm">
      <g>
        <path d="M229.8,243.2c2-1.6,3-2.4,4-3.2c13.9-11.8,31.7-10.5,43.6,3.5c1.2,1.4,1.8,1.5,3,0.3c0.8-0.9,1.7-1.6,2.5-2.5   c9.3-9.1,21.6-11.8,33.1-6.7c12.1,5.4,18.6,14.9,18.7,28.2c0.2,28.7,0.1,57.3,0.1,86c0,10.2-6.3,16.6-16.4,16.6c-4,0-8-0.3-12,0.1   c-4.1,0.4-5.3-0.9-5.3-5.2c0.2-28,0.1-56,0.1-84c0-1.2,0-2.3,0-3.5c-0.1-6.5-2.7-9.2-8.9-9.5c-5.6-0.3-9.5,3.1-10.1,8.8   c-0.1,1.3,0,2.7,0,4c0,24.2,0,48.3,0,72.5c0,10.6-6.1,16.8-16.7,16.7c-5.4-0.1-12.7,2.4-15.8-1.1c-2.7-3-0.9-10.1-0.9-15.4   c0-24.8,0-49.7,0-74.5c0-8.8-5.7-13.3-13.1-10.3c-4.6,1.9-6.1,5.6-6.1,10.4c0.1,23.2,0,46.3,0,69.5c0,1.8,0,3.7,0,5.5   c-0.3,9.7-6.5,15.8-16.1,15.9c-4,0.1-8-0.3-12,0.1c-4.3,0.4-5.6-0.8-5.5-5.4c0.2-39.3,0.1-78.6,0.1-118c0-1.7,0.1-3.3,0-5   c-0.2-2.2,0.7-2.9,2.9-2.9c9.2,0.1,18.3,0.1,27.5,0c2.3,0,3.4,0.6,3.2,3.1C229.5,239,229.7,240.6,229.8,243.2z" fill="#00B9F1"></path>
        <path d="M17.8 297.4c0 13.7 0 27.3 0 41-.1 17.8-9.4 27-27.2 27.1-7.8 0-15.7.1-23.5 0-15.8-.2-27.4-10.7-28.2-26.5-.6-11.3-.7-22.7-.1-34 .8-16.2 13.2-27.6 29.6-27.8 4.3-.1 8.7 0 13 0 4.2-.1 5.8-2.5 5.7-6.5 0-4-1.8-5.8-5.8-5.6-4.5.1-9 .1-13.5 0-11-.2-17.1-6.2-17-17 0-4.4-2-10.3.9-12.9 2.5-2.2 8.2-.8 12.5-.8 11.2-.1 22.3 0 33.5 0 11.9 0 20 8.1 20.1 20.1C17.9 268.7 17.8 283.1 17.8 297.4zM-12.8 320.1c0-1.7 0-3.3 0-5 0-10.2 0-10.2-10.2-9.8-5.1.2-7.9 2.8-8 8.1-.1 4.2-.1 8.3 0 12.5.1 7.2 3.3 9.1 13.7 9.4 7.7.2 3.8-5.2 4.5-8.2C-12.4 324.9-12.9 322.4-12.8 320.1zM106.8 286.5c0 15.3.2 30.7-.1 46-.2 11.8-3 22.5-14.4 28.8-4.6 2.5-9.6 3.9-14.8 4-11.5.2-23 0-34.5.2-2.8 0-3.4-1-3.3-3.5.2-4.2-.1-8.3.1-12.5.2-8 6.3-14.1 14.3-14.4 5.2-.2 10.3-.1 15.5 0 4.2 0 6.5-1.7 6.5-6.2 0-4.6-2.2-6.2-6.4-6.3-7-.2-14 .8-20.9-1.2-11.9-3.5-20.6-13.4-20.9-25.7-.6-19.5-.2-39-.3-58.5 0-2.2.7-2.9 2.9-2.8 8.2.1 16.3.2 24.5 0 3.6-.1 3.1 1.9 3.1 4.1 0 14.7 0 29.3 0 44 0 6.4 3 9.8 8.6 10 6.6.2 9.5-2.5 9.5-9.2 0-14.8.1-29.7-.1-44.5 0-3.5.9-4.5 4.4-4.4 7.3.3 14.7.4 22 0 4-.2 4.6 1.3 4.5 4.8C106.7 254.9 106.8 270.7 106.8 286.5zM-148 309.2c0-16.3 0-32.7 0-49 0-16 9.8-26 25.9-25.8 10.5.1 21-1.2 31.4.8 13.3 2.6 21.7 12.9 21.8 26.6.1 14.5 0 29 0 43.5 0 18.2-10.7 29.3-28.9 29.8-5.5.2-11 .1-16.5 0-2.5-.1-3.6.7-3.5 3.4.2 4 .1 8 0 12-.2 8.6-6.3 14.8-14.8 14.9-5 .1-11.3 2.1-14.5-.8-3-2.7-.8-9.1-.9-13.9C-148.1 336.9-148 323-148 309.2zM-117.8 284.7c0 3.2 0 6.3 0 9.5 0 11.3 0 11.3 11.3 10.3 4.9-.4 7.2-2.8 7.3-7.7.1-5.6-.2-11.3.1-16.9.6-16.2-2.4-14.6-15.6-14.7-2.4 0-3.2.7-3.2 3.1C-117.7 273.7-117.8 279.2-117.8 284.7z" fill="#002E6E"></path>
        <path d="M135.1,309.4c0-13.3-0.1-26.7,0.1-40c0-3.1-0.7-4.4-4.1-4.3c-4.5,0.2-10.5,1.5-13-0.7   c-3.1-2.9-0.7-9.1-1.1-13.9c0-0.3,0-0.7,0-1c0-4.7-1.5-10.2,0.5-13.7s8.1-1.3,12.4-2.4c8.5-2.2,14.9-7.1,20.1-13.9   c3.6-4.6,8.1-7.9,13.9-9c3.1-0.6,5-0.2,4.8,3.8c-0.3,5.6,0,11.3-0.1,17c-0.1,2.4,0.8,3.2,3.2,3.1c4-0.1,8,0.1,12-0.1   c2.4-0.1,3.2,0.8,3.1,3.2c-0.1,8.2-0.1,16.3,0,24.5c0,2.3-0.6,3.5-3.1,3.2c-0.5-0.1-1,0-1.5,0c-4.4,0.4-10.5-2-12.8,1   c-2.2,2.8-0.8,8.6-0.8,13.1c0,27.2-0.1,54.3,0.1,81.5c0,3.8-1,5-4.8,4.7c-3.6-0.3-7.3,0-11-0.1c-10.8-0.4-17.9-7.7-17.9-18.5   C135.1,334.4,135.1,321.9,135.1,309.4z" fill="#00B9F1"></path>
      </g>
    </svg>
);


interface ManualPaymentQRModalProps {
    isOpen: boolean;
    onClose: () => void;
    items: CartItem[];
    isGuest: boolean;
}

const formatTime12hr = (time24: string): string => {
    if (!time24) return '';
    const [hours, minutes] = time24.split(':');
    const h = parseInt(hours, 10);
    const ampm = h >= 12 ? 'PM' : 'AM';
    const formattedHours = h % 12 || 12;
    return `${formattedHours}:${String(minutes).padStart(2, '0')} ${ampm}`;
};

const calculateEndTime = (startTime: string, duration: number): string => {
    if (!startTime || !duration) return '';
    const [hours, minutes] = startTime.split(':').map(Number);
    const startDate = new Date();
    startDate.setHours(hours, minutes, 0, 0);
    const endDate = new Date(startDate.getTime() + duration * 60000);
    return endDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
};

const ManualPaymentQRModal: React.FC<ManualPaymentQRModalProps> = ({ isOpen, onClose, items, isGuest }) => {
    if (!isOpen) return null;

    const [copied, setCopied] = useState(false);
    
    // Calculate total amount from items passed in props
    const totalAmountInPaise = useMemo(() => items.reduce((sum, item) => sum + item.price, 0), [items]);

    const amountInRupees = (totalAmountInPaise / 100).toFixed(2);
    const transactionNote = `Payment for Powerful Tools purchase`;
    const upiUri = `upi://pay?pa=${UPI_ID}&pn=${encodeURIComponent(PAYEE_NAME)}&am=${amountInRupees}&cu=INR&tn=${encodeURIComponent(transactionNote)}`;

    const handleCopy = () => {
        navigator.clipboard.writeText(ADMIN_CONTACT);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
    };

    return (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-[100] p-4 backdrop-blur-sm">
            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col transform transition-all">
                <header className="p-6 border-b flex justify-between items-center flex-shrink-0">
                    <h3 className="text-2xl font-bold text-gray-800">Complete Your Purchase</h3>
                    <button type="button" onClick={onClose} className="p-2 text-gray-400 hover:bg-gray-100 rounded-full transition-colors"><X size={24} /></button>
                </header>
                
                <div className="flex-grow flex flex-col md:flex-row min-h-0">
                    {/* Left Side: Order Summary */}
                    <div className="w-full md:w-1/2 p-6 border-b md:border-b-0 md:border-r space-y-4 overflow-y-auto">
                        <h4 className="font-semibold text-lg text-gray-800 flex items-center gap-2">
                            <ShoppingBag size={20} className="text-blue-600" />
                            Order Summary
                        </h4>
                        <div className="space-y-3">
                            {items.map((item, index) => (
                                <div key={index} className="flex justify-between items-start bg-gray-50 p-3 rounded-lg">
                                    <div>
                                        <p className="font-semibold text-gray-800">{item.appName}</p>
                                        {item.isConsultation && item.appointmentTime && item.durationInMinutes ? (
                                            <p className="text-sm text-gray-600">
                                                {formatTime12hr(item.appointmentTime)} - {calculateEndTime(item.appointmentTime, item.durationInMinutes)}
                                            </p>
                                        ) : (
                                            <p className="text-sm text-gray-600">{item.tierName} - {item.credits === 0 ? 'Unlimited credits' : `${item.credits.toLocaleString()} credits`}</p>
                                        )}
                                    </div>
                                    <p className="font-semibold text-gray-800 whitespace-nowrap">₹{(item.price / 100).toFixed(2)}</p>
                                </div>
                            ))}
                        </div>
                        <div className="border-t pt-4 mt-4 flex justify-between items-center">
                             <p className="font-bold text-xl text-gray-900">Total Amount</p>
                             <p className="font-extrabold text-2xl text-blue-600">₹{amountInRupees}</p>
                        </div>
                    </div>
                    
                    {/* Right Side: Payment Instructions */}
                    <div className="w-full md:w-1/2 p-6 flex flex-col items-center justify-center bg-gray-50/50 rounded-b-2xl md:rounded-b-none md:rounded-r-2xl">
                        <p className="text-sm text-gray-600 mb-2 flex items-center gap-1.5">
                            <ShieldCheck size={16} className="text-green-600"/>
                            You are securely paying to <strong>{PAYEE_NAME}</strong>
                        </p>
                        <h4 className="text-lg font-bold text-gray-900">Scan to Pay</h4>
                        <div className="my-0.5 p-2 border-2 border-dashed rounded-lg inline-block bg-white">
                             <QRCodeCanvas value={upiUri} size={160} />
                        </div>
                        <div className="flex items-center justify-center gap-4 my-0.5 opacity-80">
                            <GPayLogo />
                            <PhonePeLogo />
                            <PaytmLogo />
                        </div>
                        <div className="text-left w-full space-y-3 bg-white p-4 rounded-lg border mt-0.5">
                            <h5 className="font-semibold text-gray-800">Important Instructions:</h5>
                            <ol className="list-decimal list-inside space-y-1.5 text-xs text-gray-700">
                                <li>Scan the QR code with any UPI app (GPay, PhonePe, etc.).</li>
                                <li>
                                    After payment, send the screenshot to our admin on WhatsApp.
                                    <div className="flex items-center gap-1.5 mt-1">
                                        <MessageSquare size={14} className="text-green-600 flex-shrink-0" />
                                        <strong className="font-mono">{ADMIN_CONTACT}</strong>
                                        <button onClick={handleCopy} className="p-1 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-200 transition-colors">
                                            {copied ? <Check size={14} className="text-green-600" /> : <Copy size={14} />}
                                        </button>
                                    </div>
                                </li>
                                {isGuest && (
                                    <li className="text-red-600 font-medium">Please include your Full Name & Email in the message.</li>
                                )}
                                <li>Your credits {isGuest ? 'and account' : ''} will be activated upon verification.</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <footer className="bg-gray-50 px-6 py-4 flex justify-end gap-3 rounded-b-2xl border-t flex-shrink-0">
                    <button
                        onClick={onClose}
                        className="w-full sm:w-auto rounded-lg bg-blue-600 px-6 py-3 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
                    >
                        I have paid, close this window
                    </button>
                </footer>
            </div>
        </div>
    );
};

export default ManualPaymentQRModal;
